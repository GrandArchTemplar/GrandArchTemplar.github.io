<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Graham</title>
</head>
<body>
<h1>This is Graham visualisation</h1>

<div id="mainContainer">
    <canvas class="normalBordered" id="mainCanvas"></canvas>
    <div id="buttonContainer" class="normalBordered">

        <button type="button" class="normalButton" id="start">Start</button>
        <button type="button" class="normalButton" id="pause">Pause</button>
        <button type="button" class="normalButton" id="stop">Stop</button>
        <button type="button" class="normalButton" id="hard" onclick="redraw(radius + 2)">Hard</button>
        <button type="button" class="normalButton" id="mode">Mode</button>
        <button type="button" class="normalButton" id="next">Next</button>
        <br>
        Speed:
        <input type="range" min="0" max="42" step="0.1" value="21" id="speed" title="Speed">
        <form name="input" onsubmit="return false">
            Number of Vertex:
            <label>
                <input type="number" name="vertexCount" min="3" max="100">
            </label><br>
            <input type="button" id="draw" value="Draw">
        </form>

    </div>
</div>

<script>
    const mainCr = Object.freeze(document.getElementById("mainContainer"));
    const canvas = Object.freeze(document.getElementById("mainCanvas"));
    const state  = Object.freeze(new Map());
    const radius = Object.freeze(5);
    const drawer = Object.freeze(canvas.getContext("2d"));
    const promisedPolygon = Object.freeze(new Promise(resolve => {
        const button = Object.freeze(document.getElementById("draw"));
        button.onclick = Object.freeze(function () {
            resolve(generatePoints(radius));
        })
    }));

    function test() {
        const play = document.getElementById("start");
        play.style.width = 20;
        play.style.height = 20;

    }

    const pair = (...args) => Object.freeze(args.slice(0, 2));

    function generatePoints(r) {

        const n = Object.freeze(document.forms["input"]["vertexCount"].value);
        const points = [];
        for (let i = 0; i < n; i++) {
            const x = Math.random() * (canvas.width * 0.8 - 2 * r) + canvas.width * 0.1;
            const y = Math.random() * (canvas.height * 0.8 - 2 * r) + canvas.height * 0.1;
            points.push(pair(x, y));
        }
        return points;
    }

    function initDraw(r) {
        promisedPolygon.then(p => {
            drawer.beginPath();
            p.forEach(e => {
                const x = e[0];
                const y = e[1];
                drawer.moveTo(x + r, y);
                drawer.arc(x, y, r, 0, 2 * Math.PI);
                drawer.fillStyle = "grey";
                drawer.fill();
                drawer.fillText("x: " + (x | 0) + " y: " + (y | 0), x + 10, y + 5);
            });
            drawer.stroke();
        });
    }

    function redraw(r) {

        promisedPolygon.then(p => {
            drawer.beginPath();
            p.forEach(e => {
                const x = e[0];
                const y = e[1];
                drawer.moveTo(x + r, y);
                drawer.arc(x, y, r, 0, 2 * Math.PI);
                drawer.fillStyle = "grey";
                drawer.fill();
                drawer.fillText("x: " + (x | 0) + " y: " + (y | 0), x + 10, y + 5);
            });
            drawer.stroke();
        });
    }

    function styleIt() {
        mainCr.style.display = "-webkit-flex";
        Array
            .prototype
            .slice
            .call(document
                .getElementsByClassName("normalBordered"))
            .forEach(e => {
            e.style.margin = "1px";
            e.style.border = "1px solid #000000";
        });
    }

    function globalResize() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        canvas.width = width * 0.75;
        canvas.height = height * 0.8;

    }


    function init() {
        state.set("isStarted", false);
        state.set("isSmooth", false);

        globalResize();
        styleIt();
        initDraw(radius);
        test();
    }

    init();
</script>
</body>
</html>