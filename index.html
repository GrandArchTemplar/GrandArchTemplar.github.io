<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Graham</title>
</head>
<body>
<h1>This is Graham visualisation</h1>

<div id="mainContainer">
    <canvas class="normalBordered" id="mainCanvas"></canvas>
    <div id="buttonContainer" class="normalBordered">

        <button type="button" class="normalButton" id="start">Start</button>
        <button type="button" class="normalButton" id="pause">Pause</button>
        <button type="button" class="normalButton" id="stop">Stop</button>
        <button type="button" class="normalButton" id="hard">Hard</button>
        <button type="button" class="normalButton" id="mode">Mode</button>
        <button type="button" class="normalButton" id="next">Next</button>
        <br>
        Speed:
        <input type="range" min="0" max="42" step="0.1" value="21" id="speed" title="Speed">
        <form name="input" onsubmit="return false">
            Number of Vertex:
            <label>
                <input type="number" name="vertexCount" min="3" max="100">
            </label><br>
            <input type="button" id="draw" value="Draw">
        </form>

    </div>
</div>

<script>
    let mainCr = document.getElementById("mainContainer");
    let canvas = document.getElementById("mainCanvas");
    let state = new Map();
    const radius = 5;
    const promisedPolygon = new Promise(resolve => {
        let button = document.getElementById("draw");
        button.onclick = function () {
            resolve(generatePoints(radius));
        }
    });

    function test() {
        let play = document.getElementById("start");
        play.style.width = 20;
        play.style.height = 20;

    }

    const pair = (...args) => Object.freeze(args.slice(0, 2));

    function generatePoints(r) {
        let n = document.forms["input"]["vertexCount"].value;
        let points = new Array(n);
        for (let i = 0; i < n; i++) {
            let x = Math.random() * (canvas.width * 0.8 - 2 * r) + canvas.width * 0.1;
            let y = Math.random() * (canvas.height * 0.8 - 2 * r) + canvas.height * 0.1;
            points[i] = pair(x, y);
        }
        return points;
    }

    function initDraw(r) {
        if (state.get("isClear")) {
            return;
        } else {
            state.set("isClear", true);
        }
        let drawer = canvas.getContext("2d");
        promisedPolygon.then(p => {
            drawer.beginPath();
            p.forEach(e => {
                let x = e[0];
                let y = e[1];
                drawer.moveTo(x + r, y);
                drawer.arc(x, y, r, 0, 2 * Math.PI);
                drawer.fillStyle = "grey";
                drawer.fill();
            });
            drawer.stroke();
        });

    }

    function styleIt() {
        mainCr.style.display = "-webkit-flex";

        let nb = document.getElementsByClassName("normalBordered");
        Array.prototype.slice.call(nb).forEach(e => {
            e.style.margin = "1px";
            e.style.border = "1px solid #000000";
        });
    }

    function globalResize() {
        let width = window.innerWidth;
        let height = window.innerHeight;

        canvas.width = width * 0.75;
        canvas.height = height * 0.8;

    }


    function init() {
        state.set("isStarted", false);
        state.set("isSmooth", false);
        state.set("isClear", false);
        globalResize();
        styleIt();
        initDraw(radius);
        test();
    }

    init();
</script>
</body>
</html>